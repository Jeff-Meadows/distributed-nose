{"tagline":"Distribute your nose tests across multiple machines, hassle-free","body":"# distributed-nose Distribute your tests across multiple nodes with no hassle\r\n\r\n## TLDR\r\n\r\n### Before\r\n\r\nMachine 1:\r\n\r\n\t$ nosetests long_test_suite\r\n\t...\r\n\tRan 1312 tests in 401.109s\r\n\r\nMachine 2:\r\n\r\n\t$ echo \"I'm bored :(\"\r\n\tI'm bored :(\r\n\t$ uptime | awk -F'load average:' '{ print \"Load: \" $2 }'\r\n\tLoad: 0.00, 0.00, 0.00\r\n\r\nDeveloper:\r\n\r\n\t$ google-chrome http://news.ycombinator.com\r\n\r\n### After\r\n\r\nMachine 1:\r\n\r\n\t$ export NOSE_NODES=2;\r\n\t$ export NOSE_NODE_NUMBER=1;\r\n\t$ nosetests long_test_suite\r\n\t...\r\n\tRan 660 tests in 220.502s\r\n\r\nMachine 2:\r\n\r\n\t$ echo \"I feel loved\"\r\n\tI feel loved\r\n\t$ export NOSE_NODES=2;\r\n\t$ export NOSE_NODE_NUMBER=2;\r\n\t$ nosetests long_test_suite\r\n\t...\r\n\tRan 652 tests in 214.007s\r\n\r\n## The Saga of Your Test Suite\r\n\r\n### Oppression of Untested Code\r\n\r\nThe story of Your Test Suite has its heroes and its villains,\r\nits triumphs and its missteps.\r\nLike many other stories,\r\nit begins with a solitary hero.\r\nGraduating from university,\r\nshe joins on with a merry band of software engineering adventurers.\r\nLed by management and supported by a wide cast of characters,\r\nthey built things that the common folk loved and needed.\r\n\r\nSlowly slowly, things begin to change.\r\nPoorly-structured and strongly-coupled code sneaks in to the code base,\r\nmaking changes increasingly difficult\r\nand allowing devious bugs to emerge.\r\nParty members begin to regularly break disparate parts of the project,\r\nthe realm being too large to survey quickly for one person.\r\nAreas of code become off-limits,\r\nas dragons and unknown things claim all who attempt entry.\r\n\r\nThrough all this, our hero watches with a heavy heart.\r\nWhat is to be done about this untested code-base?\r\nSurely she can't change everything by herself?\r\nShe is just one person!\r\n\r\nFinally, the daily struggles wear her down.\r\n\r\n\"Enough is enough!\"\r\n\r\nShe resolves, pontificating on how to best strike\r\nagainst the oppression of untested code.\r\n\r\n\"I'll write tests, and commit them to source control!\"\r\n\r\nShe says,\r\nunderstanding that working code is the best possible argument.\r\n\r\n### A Nose-fueled Peace\r\n\r\nMethodically wielding and teaching [Nose](https://github.com/nose-devs/nose),\r\nshe recruits from within to form a merry band of like-minded developers.\r\nThey are the fellowship of TDD\r\nand they are determined to succeed.\r\nTests are committed in flurries of high-value code!\r\n\r\nTales of the fellowship's feats stir excitement in other developers.\r\nAnother hero decides that if running some tests is good,\r\nthen running all the tests all the time is better!\r\nBrandishing his hat of System Administration,\r\nhe utilizes extra server resources and\r\na Continuous Integration process is born.\r\n\r\nOur heroes grow over-confident in their success, however.\r\nMaking little attempt to justify the practice,\r\nword of time spent writing tests gets to management.\r\nManagerial Oversight moves to squash our fledgling fellowship.\r\n\r\n### Managerial Push-back\r\n\r\n\"If you have time to write tests,\r\nI must have not given you enough to do!\"\r\n\r\nThey snarl,\r\nthreatening with the most dangerous of weapons:\r\nThe sling of passive-aggressive disagreement.\r\n\r\nOnce again, our heroes summon their courage,\r\nand through great effort,\r\nboldly vanquish Managerial Opposition with the sword of high quality.\r\nA new era of peace and productivity begins\r\nand The Project flourishes.\r\n\r\nBut that peace was not to last.\r\nThe specter of Slow Test Runs looms over our heroes.\r\nSoon, test failures go unnoticed.\r\nDevelopers aren't waiting for tests to finish!\r\nThe Test Suite falls in to decay.\r\n\r\n### Multiprocess Arrives\r\n\r\nDevelopers grumble and management freely lobs I-Told-You-Sos.\r\nThe darkness of the age before tests threatens to return.\r\n\r\n\"I'll speed up our tests!\"\r\n\r\nA voice cries out.\r\nIt's our hero again,\r\nvowing to strike at the root cause of decay.\r\n\r\nPouring over ancient texts,\r\nshe quickly discovers\r\n[Multiprocess](http://nose.readthedocs.org/en/latest/plugins/multiprocess.html).\r\n\r\n\"This will release us from our single-core shackles.\"\r\n\r\nShe proclaims, confident.\r\nHours later,\r\nher 8-core machine races through tests with alacrity.\r\nSoon, multiprocess is in use on the CI server,\r\nand test speed races forward.\r\n\r\nAll is right in test land!\r\nHer fellow developers throw a break-room party\r\nin her honor.\r\nPython Meetup talks flow like water\r\nand TDD is once again well-liked by all.\r\n\r\nLike the previous peace,\r\nthis too is temporary,\r\nas adding more cores is costly.\r\nFast forward several score tests,\r\nand the once-speedy test suite\r\nregularly brings the beefy, multi-core CI server to its knees.\r\n\r\n### Distributed Despair\r\n\r\nRemembering the ease of implementing Multiprocess,\r\nour hero knows the drill.\r\nShe'll simply distribute the tests across multiple servers!\r\nThe same ancient tomes are confidently consulted,\r\nas the solution seemingly obvious.\r\n\r\nBut wait!\r\n\r\nWhere are the simple guides?\r\n\r\nOur hero isn't a wizard.\r\nShe can't decipher the ancient scrolls of distributed systems.\r\nShe doesn't have time for formal wizard training,\r\nand the number of moving parts involved is boggling.\r\n\r\nDespair sets in as the once-speedy test sweet becomes slower and slower.\r\nThe outlook for our adventurers is bleak,\r\nas an evaluation of speeding up the tests themselves reveals immense challenge.\r\nSome even suggest abandoning the test suite entirely\r\nwith a new focus on speed!\r\n\r\nFactions form and the party threatens to splinter entirely!\r\n\r\n### Distributed-Nose: The Scalable Solution\r\n\r\n\"Wait a minute.\"\r\n\r\nA clear voice breaks through.\r\nIt's our hero, once again.\r\n\r\n\"Why do our test runners need to communicate to coordinate?\r\nOur memcached servers need the same level of coordination\r\nand achieve it with ease!\"\r\n\r\nTickled by the flickering of an idea,\r\nshe sets to work.\r\nShe is steadfast, pouring over tomes on\r\n[Consistent Hashing](http://en.wikipedia.org/wiki/Consistent_hashing).\r\nOnce the solution is clear in her mind,\r\nshe happens upon a fellow adventurer with sound advice.\r\n\r\n\"Have you tried distributed-nose?\"\r\n\r\n\"Unfortunately.\r\nI'm terribly allergic to pollen\r\nand I get that every spring.\"\r\n\r\nAfter the initial confusion is resolved,\r\nit becomes clear to our hero\r\nthat other adventurers have already crossed this path.\r\nHooray!\r\n\r\nShe quickly skims a strained narrative introduction,\r\nfinding it, frankly, quite derivative.\r\nSkipping to the operationalizable section of the tome,\r\nshe finds fast success.\r\nThis is the tool for them.\r\n\r\nWith minimal effort,\r\nThe Test Suite is distributed across 4 machines.\r\nTest time is slashed and\r\nThe Test Suite is saved.\r\nPondering the future, our hero realizes\r\nshe will never again face uncertainty about scalability.\r\nShe can always just add more machines!\r\n\r\nTest Suite scalability ensured,\r\nour heroes go on to face many other adventures and trials.\r\nBut never again would something come so close to erasing their very core\r\nas the oppression of untested code.\r\n\r\n## Why distributed-nose?\r\n\r\nScale your tests horizontally across unlimited machines with two test flags.\r\n\r\n## Installation\r\n\r\n1. Get the project source and install it\r\n\r\n    $ pip install distributed-nose\r\n\r\n## Usage\r\n\r\nTo run half your tests on one machine and the other half on the other:\r\n\r\nMachine 1:\r\n\r\n\t$ nosetests --nodes 2 --node-number 1 long_test_suite\r\n\r\nMachine 2:\r\n\r\n\t$ nosetests --nodes 2 --node-number 2 long_test_suite\r\n\r\nAlternatively, you can use the environment variables:\r\n* `NOSE_NODES`\r\n* `NOSE_NODE_NUMBER`\r\n\r\n### Temporarily disabling test distribution\r\n\r\nIn the case that you're using environment variables\r\nto control test distribution,\r\nyou sometimes still might want to run a one-off test.\r\nInstead of fiddling with environment variables,\r\nyou can just use the `--distributed-disabled` flag.\r\n\r\n\t$ export NOSE_NODES=2;\r\n\t$ export NOSE_NODE_NUMBER=1;\r\n\t$ nosetests --distributed-disabled long_test_suite\r\n\r\n## Distribution algorithm\r\n\r\nTo determine which node runs which test,\r\ndistributed-nose relies on the [hash_ring](https://github.com/Doist/hash_ring)\r\nlibrary's consistent hashing implementation.\r\n\r\n## Is it Awesome?\r\n\r\nYes. Increasingly so.\r\n","note":"Don't delete this file! It's used internally to help with page regeneration.","google":"","name":"Distributed-nose"}